<link rel="stylesheet" href="/stylesheets/learning-course.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha512-Fo3rlrZj/k7ujTnHg4CGR2D7kSs0v4LLanw2qksYuRlEzO+tcaEPQogQ0KaoGN26/zrn20ImR1DfuLWnOo7aBA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<div class="col-md-12 d-flex">

    <% if(list_chapter.length === 0 || list_chapter === null) { %>
        <div class="col-md-12">
            <p>This course not has any videos</p>
        </div>
    <% } else { %>
        <div class="col-md-9">
            <video id="myVideo" width="100%" height="400" controls>
                <source id="my_video_url" src="<%= list_chapter[0].list_video[0].video_url%>" type="video/mp4">
                Your browser does not support HTML5 video.
            </video>
            <div class="d-flex">
                <a href="#" class="btn btn-star" onclick="handleNoteVideo('overview')">Overview</a>
                <a href="#" class="btn btn-star" onclick="handleNoteVideo('notes')" >Notes</a>
                <a href="/course/<%-course.slug%>" class="btn btn-star" onclick="handleNoteVideo('ratestar')" >Rate Star</a>
            </div>
            <div id="overview" class="note">
                <p><%= list_chapter[0].list_video[0].title %></p>
                <p><%= list_chapter[0].list_video[0].description %></p>
            </div>
            <div  id="notes" class="note" style="display:none">
                <div class="create-note">
                    <span>
                        Create a new note
                    </span>
                    <i class="fas fa-plus-circle"></i>
                </div>
                <form action="" method="post" id="form-submit"> 
                    <textarea name="" id="textarea" rows="2" cols="50" placeholder="Tạo ghi chú">
                    </textarea>
                   <div class="form-btn">
                    <button type="button" id="cancel">Cancel</button>
                    <button type="submit" id="save">Save note</button>
                   </div>
                </form>    
            </div>
        </div>
        <div class="col-md-3">
            <ul>
                <%for(let i = 0; i < list_chapter.length; i++) { %>
                    <li class="chapter-item">
                        <span class="chapter-position">Chapter <%= list_chapter[i].position%>:</span> <%= list_chapter[i].title %>
                        <ul>
                            <% list_chapter[i].list_video.forEach((video,index) => {%>
                                <li class="video-item" data-url="<%=video.video_url%>" data-id="<%=list_chapter[i].list_video[index]._id%>">
                                    <span class="video-position">Video <%= video.position %>:</span>
                                    <%= video.title %>
                                </li>
                            <% }) %>
                        </ul>
                    </li>
                <% } %>
            </ul>
            <p>Test your knowledge here <a href="/myLearning/quiz/<%-course.slug%>">FINAL EXAM</a></p>
        </div>
    <% } %>

</div>
<script>
    var vid = document.getElementById("myVideo");
    var source = document.getElementById("my_video_url");
    let listVideo = document.getElementsByClassName("video-item");
    let createNote= document.querySelector('.create-note');
    let cancel=document.querySelector('#cancel');
    let save=document.querySelector('#save');
    let formNote= document.querySelector('#form-submit');
    let overView= document.querySelectorAll('.btn-star')[0];
    let notes= document.querySelectorAll('.btn-star')[1];
    let rateStar= document.querySelectorAll('.btn-star')[2];

    let count = 0;
    vid.addEventListener('canplay', function(){
        let percent;
        percent = Math.round((vid.currentTime / vid.duration) * 100);
        console.log('ok: ', percent+"%");
    })
    function load_ajax() {
        let percent;
        percent = Math.round((vid.currentTime / vid.duration) * 100);
         if(percent > 90) {
             count++;
            $.ajax({
                    url : "process/store",
                    type : "POST",
                    dataType:"json",
                    data : obj,
                    success : function (result){
                        console.log("Successful");
                    }
                });
         }
    }
     setInterval(() => {
         load_ajax();
     }, 1000);
     console.log('Total video: ', listVideo.length);    
    Array.prototype.forEach.call(listVideo, video => {
        video.addEventListener('click', function(e) {
            let url_video = e.target.getAttribute('data-url');
            source.setAttribute("src", url_video);
            console.log('source: ',source.src);
        })
    });
    // handle note video
    function handleNoteVideo(e){
        let note=document.querySelectorAll('.note');
        for (i = 0; i < note.length; i++) {
            note[i].style.display = "none";
        }
        document.getElementById(e).style.display = "block";
    }
    createNote.addEventListener('click',function(){
        formNote.style.display = "block";
    });
    cancel.addEventListener('click',function(){
        formNote.style.display = "none";
    });

    save.addEventListener('click',function(){
        vid.currentTime=5;
    }); 

</script>
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>